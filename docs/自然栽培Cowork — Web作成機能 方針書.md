# 自然栽培Cowork — Web作成機能 方針書

## コンセプト

栽培記録とスキルがあれば、農家が簡単に自分のWebサイトを持てる。

## 設計思想

- 無料版はシンプルなテンプレートで誰でも使える
- 自由にカスタマイズしたい人はPC + AIで自分で作る
- プラットフォーム側が複雑な機能を開発・保守し続けない
- AIが進化すれば、ユーザーができることも自然に広がる

---

## 2つのモード

### スマホ版（無料・テンプレート）

- テンプレートから選ぶだけでサイト生成
- 栽培記録データが自動で流し込まれる
- カスタマイズは最小限（色・写真・テキスト程度）
- 写真は最大20枚まで
- サーバー側でバッチ処理（即時生成ではない）
- 生成回数の制限あり（例: 月3回）
- こちらが管理するCloudflareアカウントで公開
- セットアップ不要

### PC版（自由・Cowork的）

- Claude AIがサイトをゼロから生成
- デザイン・レイアウトの自由度は無制限
- スキルの作成・編集が可能
- ローカルFastAPIで処理（データ主権をユーザーが持つ）
- 農家が自分のCloudflare + Claude APIを使う
- 生成回数の制限なし、即時生成
- 初期設定はアプリ内の日本語ウィザードで自力セットアップ

### 移行パス

スマホ版で始める → 回数制限が足りない / 即時生成したい / 自由にデザインしたい → PC版に移行

---

## インフラ構成（Cloudflareで完結）

### スマホ版（こちらが管理する1アカウント）

| 役割 | サービス | 無料枠 |
|------|---------|--------|
| 画像配信 | Pages | 20,000ファイル、帯域無制限 |
| HTML配信 | R2 | 10GB、帯域無制限 |
| 画像の所有者管理 | KV | 読取10万回/日、書込1,000回/日 |

### スケーリング目安

| ユーザー数 | 画像（Pages） | HTML（R2） | 月額コスト |
|-----------|--------------|-----------|-----------|
| 〜1,000 | 20枚×1,000=20,000ファイル | 数MB | $0 |
| 〜5,000 | Pages有料化（100,000ファイル） | 10GB以内 | 約$20 |
| 10,000〜 | 複数プロジェクト分割 | 超過分$0.015/GB | 約$25〜 |

### PC版（農家個人のアカウント）

- 農家が自分のCloudflare Pagesにデプロイ
- 農家が自分のClaude APIを利用
- こちらのインフラ負荷なし

---

## AI処理コスト（スマホ版）
サーバーのバッチで処理
当面は、Claude MAXプランを使用
将来的に、Claude Batch APIを使用
- プロンプトキャッシュ併用でさらに90%オフ（テンプレート部分）

---

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| スマホUI | Flutter（自己完結型Widget） |
| PC版UI | Flutter（同上） |
| バックエンド（スマホ版） | FastAPI（サーバー上） |
| バックエンド（PC版） | FastAPI（ローカルPC） |
| AI生成（スマホ版） | Claude Code, Claude Batch API |
| AI生成（PC版） | Claude Code（農家が契約、モデル自由） |
| ホスティング | Cloudflare Pages / R2 / KV |

---

## 処理フロー

### スマホ版（バッチ処理）

```
農家がアプリでデータ・写真をアップロード
  → サーバーにリクエストを蓄積
  → 定期的に一括処理
  → 生成されたHTMLをR2に配置、画像をPagesに配置、KVに所有者情報記録
  → 農家に完了通知
```

### PC版（即時処理）

```
農家がアプリで「サイトを作る」を実行
  → ローカルFastAPIがデータ整理
  → Claude APIでHTML即時生成
  → 農家がプレビュー確認・承認
  → 農家のCloudflare Pagesにデプロイ
```

### 画像削除フロー

```
KVでユーザーの画像一覧を取得
  → Pagesから該当ファイルを削除
  → KVを更新
```

---

## Cloudflare初期設定（PC版のみ）

農家が自力で行う3ステップ:

1. Cloudflareアカウント作成（メール + パスワード）
2. APIトークン生成（Pages用の権限）
3. トークンをアプリに貼り付け → 接続テスト

アプリ内にスクリーンショット付き日本語ウィザードを提供。

---

## 開発方針

- スマホ版のテンプレート + バッチ処理の作成
- PC版はClaude AIに生成を任せるため、複雑なUI機能の開発は不要
- プラットフォーム側が保守する機能を最小限にする
- AIの進化に合わせてPC版の可能性は自然に広がる